#include "music.h"
#include "beep.h"
#include "delay.h"

//??
uc16 tone[] = {247,262,294,330,349,392,440,494,523,587,659,698,784,880,988,1046,0};

u8 scale = 16;

u8 BrokenMoon[]={
	
 
	4, 4, 4, 4,6,6,6,6,
	5, 5, 5, 5,8,8,8,8,
	9, 9, 9, 9,9,9,9,9,
	9, 9, 9, 9,5,4,3,1,
	2, 0, 2, 6,5,0,4,0,
	3, 0, 3, 3,5,0,4,3,
	2, 0, 2, 11,10,11,10,11,
	2, 0, 2, 11,10,11,10,11,
	2, 0, 2, 6,5,0,4,0,
	3, 0, 3, 3,5,0,4,3,
	2, 0, 2, 11,10,11,10,11,
	2, 0, 2, 11,10,11,10,11,
	2, 0, 2, 6,5,0,4,0,
	3, 0, 3, 3,5,0,4,3,
	2, 0, 2, 11,10,11,10,11,
	2, 0, 2, 11,10,11,10,11,
	4, 4, 4, 4,6,6,6,6,
	5, 5, 5, 5,8,8,8,8,
	9, 9, 9, 9,9,9,9,9,
	9, 9, 9, 9,5,4,3,1,
	2, 0, 2, 6,5,0,4,0,
	3, 0, 3, 3,5,0,4,3,

};
u8 BrokenMoonTime[]={
	
  8, 8, 8, 8,8,8,8,8,
	8, 8, 8, 8,8,8,8,8,
	8, 8, 8, 8,8,8,8,8,
  8, 8, 8, 8,8,8,8,8,
	8, 8, 8, 8,8,8,8,8, 
	8, 8, 8, 8,8,8,8,8,
	8, 8, 8, 8,8,8,8,8,
	8, 8, 8, 8,8,8,8,8, 
	8, 8, 8, 8,8,8,8,8,
	8, 8, 8, 8,8,8,8,8,
  8, 8, 8, 8,8,8,8,8,
	8, 8, 8, 8,8,8,8,8,
	8, 8, 8, 8,8,8,8,8,
  8, 8, 8, 8,8,8,8,8,
	8, 8, 8, 8,8,8,8,8, 
	8, 8, 8, 8,8,8,8,8,
	8, 8, 8, 8,8,8,8,8,
	8, 8, 8, 8,8,8,8,8, 
	8, 8, 8, 8,8,8,8,8,
	8, 8, 8, 8,8,8,8,8,
  8, 8, 8, 8,8,8,8,8,
	8, 8, 8, 8,8,8,8,8,
	
	
};

void BUZZER_Play(u16 frq){
	u32 time;
	if(frq){
//		time = 500000/((u32)frq);//????????????(???us)?1*10^6/2f=500000/f	f??????
		time = 50000/((u32)frq);
		beep_on();
		delay_us(time);
		beep_off();
		delay_us(time*9);//?????
	}
	else delay_us(1000);
}

void MUSIC_Play(u8 *music,u8 *time,u16 length){
	u16 i,j;
	for(i=0;i<length;i++)
		for(j=0;j<((u16)time[i])*tone[music[i]]/scale;j++) //time[i]*tone[music[i]]????????
			BUZZER_Play((u32)tone[music[i]]);
}


//????
void MUSIC1_Play(void){
	MUSIC_Play(BrokenMoon,BrokenMoonTime,sizeof(BrokenMoon)/sizeof(BrokenMoon[0]));
}
